<!DOCTYPE html>
<html id="html" class="html">
  <head lang="en_GB">
  <meta charset="utf-8" />
  <title data-react-helmet="true">BackboneJs Grouped Collection Techniques - Four Approaches - Brendan Graetz</title>
  <meta data-react-helmet="true" name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"/><meta data-react-helmet="true" name="og:ttl" content="600"/><meta data-react-helmet="true" name="og:site_name" content="Brendan Graetz"/><meta data-react-helmet="true" name="og:description" content="The blog that Brendan writes"/><meta data-react-helmet="true" name="og:locale" content="en_GB"/><meta data-react-helmet="true" name="og:title" content="BackboneJs Grouped Collection Techniques - Four Approaches - Brendan Graetz"/><meta data-react-helmet="true" name="og:url" content="http://blog.bguiz.com/2013/10/22/backbonejs-grouped-collection-techniques-four/"/><meta data-react-helmet="true" name="og:image" content="http://blog.bguiz.com/images/logo-400px.png"/><meta data-react-helmet="true" name="og:type" content="article"/>
  <link data-react-helmet="true" rel="canonical" content="http://blog.bguiz.com/2013/10/22/backbonejs-grouped-collection-techniques-four/"/>
</head>
  <body>
    <div id="outlet" class="outlet">
      <div id="root-page" class="root-page"><noscript></noscript><div id="navbar" class="navbar__navbar___3unxB"><ul id="navbar-list" class="navbar__navbar-list___33l7N"><li class="navbar__navbar-item___bZsgu"><a class="fa fa-home" title="Brendan Graetz" href="/"></a></li><li class="navbar__navbar-item___bZsgu"><a class="fa fa-files-o" title="Archives" href="/archives"></a></li><li class="navbar__navbar-item___bZsgu"><a class="fa fa-television" title="Presentations" href="/presentations"></a></li><li class="navbar__navbar-item___bZsgu"><a class="fa fa-book" title="Books" href="/books"></a></li><li class="navbar__navbar-item___bZsgu"><a href="https://twitter.com/bguiz" class="fa fa-twitter" title="@bguiz on Twitter"></a></li><li class="navbar__navbar-item___bZsgu"><a href="https://github.com/bguiz" class="fa fa-github" title="bguiz on github"></a></li><li class="navbar__navbar-item___bZsgu"><a href="http://stackoverflow.com/users/194982/bguiz" class="fa fa-stack-overflow" title="bguiz on stackoverflow"></a></li><li class="navbar__navbar-item___bZsgu"><a href="http://linkedin.com/in/brendangraetz/" class="fa fa-linkedin" title="Brendan Graetz on LinkedIn"></a></li><li class="navbar__navbar-item___bZsgu"><a href="http://reddit.com/u/bguiz" class="fa fa-reddit-alien" title="/u/bguiz on Reddit"></a></li><li class="navbar__navbar-item___bZsgu"><a href="https://plus.google.com/112370545733832378774?rel=author" class="fa fa-google-plus" title="@bguiz on Google+"></a></li></ul></div><div id="root-content" class="root-content"><div id="page-post" class="page page-post"><noscript></noscript><h1 id="page-title" class="page-title post-page__page-title___2KPKG">BackboneJs Grouped Collection Techniques - Four Approaches</h1><div id="page-body" class="page-body"><div class="post-page__post-date___3HkPG">2013/10/22</div><span class="markdown__markdown-render___9BIqe"><p>We start off with a standard Backbone model. Owing to my creative streak, I have decided to give it
the exciting name of <code>Foo</code>.</p>

<pre><code>var Foo = Backbone.Model.extend({
    /* some code here */
});
</code></pre>

<p>The next thing that we do is to define a collection of <code>Foo</code> models.</p>

<pre><code>Foo.Collection =  Backbone.Collection.extend({
    model: Foo,
    /* some code here */
});
</code></pre>

<p>This is important to do because we will be:</p>

<ul><li>fetching multiple <code>Foo</code>s in a single HTTP request</li>
<li>displaying mutliple <code>Foo</code>s in a single Backbone view</li>
</ul><h2>Spanner in the works</h2>

<p>Next we add an additional requirement to the above.
We are no longer satisified with displaying <code>Foo</code>s in a flat list in the views.
We want them to be grouped according to a particular attribute, <code>bar</code> that every <code>Foo</code> has.</p>

<p>There are several ways to do this:</p>

<pre><code>//alternative #1
Foo.Collection =  Backbone.Collection.extend({
    model: Foo,
    initialize: function(initialModels, options) {
        this.listenTo(this, ‘add remove sync’, this._regroup);
        this._groupedData = [];
    },
    _regroup: function() {
        //TODO parse collection and group by bar
    },
    getGroupedModels: function() {
        return this._groupedData;
    }
});
</code></pre>

<p>In alternative #1, the collection listens to any changes on itself.
As soon as one occurs, the regroup function is run.
The view that wishes to display the grouped collection of <code>Foo</code>s calls <code>getGroupedModels</code>, and the grouping is always up to date.</p>

<pre><code>//alternative #2
Foo.Collection =  Backbone.Collection.extend({
    model: Foo,
    initialize: function(initialModels, options) {
        this._groupedData = [];
    },
    _regroup: function() {
        //TODO parse collection and group by bar
    },
    getGroupedModels: function() {
        this._regroup();
        return this._groupedData;
    }
});
</code></pre>

<p>In alternative #2, the collection does <em>not</em> listen to changes on itself.
Instead, only when the view calls <code>getGroupedModels</code>, does it run the regroup function.
Thus the grouping is not always up to date, and is recomputed just in time for when it is needed.</p>

<pre><code>//alternative #3
Foo.Collection =  Backbone.Collection.extend({
    model: Foo,
    initialize: function(initialModels, options) {
        this.listenTo(this, ‘add remove sync’, this._flagForRegroup);
        this._groupedData = [];
        this._needsRegroup = true;
    },
    _flagForRegroup: function() {
        this._needsRegroup = true;
    },
    _regroup: function() {
        this._needsRegroup = false;
        //TODO parse collection and group by bar
    },
    getGroupedModels: function() {
        if (this._needsRegroup) {
            this._regroup();
        }
        return this._groupedData();
    }
});
</code></pre>

<p>In alternative #3, the collection listens to changes on itself once more, same as in alternative #1.
This time, however, the response to the change event is different:
Instead of running the regroup function, as we did in alternative #1, we simply toggle a flag that indicates that a regroup needs to be done.
When the view calls <code>getGroupedModels</code>, the regroup function is run only if the flag has been set,
and of course, the flag is reset.
Thus regroup is not run every time the collection is updated,
and instead only when the collection is accessed, <em>and</em> is known to be out of date.
This is done to ensure maximum laziness in computing the regroup.</p>

<pre><code>//alternative #4
Foo.GroupedCollection = Backbone.Collection.extend({
    initialize(models, options) {
        this._origCollection = options.origCollection;
        this.listenTo(this._origCollection, ‘add remove sync’, this._regroup);
    },
    _regroup: function() {
        //parse this._origCollection and group by bar
    }
});
</code></pre>

<p>In alternative #4, the view requires a Backbone collection - a simple Javascript array will not suffice.
So we leave <code>Foo.Collection</code> alone, and define another collection alongside it.
We&#8217;ll call this one <code>Foo.GroupedCollection</code>.
(My creativity strikes once again!)
<code>Foo.GroupedCollection</code> expects to be passed a <code>Foo.Collection</code> in its options when initialized.
The grouped collection listens for changes on the regular collection;
whenever the regular collection changes, it runs the regroup function, keeping itself up to date.</p>

<h2>Source</h2>

<p><a href="https://gist.github.com/bguiz/7021513" target="_blank">Github Gist with all the above code</a></p>

<h2>Conclusion</h2>

<p>Alternative #4 is the only option when the view displaying the grouped collection is expecting a Backbone collection.
Otherwise, any of alternatives #1 through #3 will do the job:</p>

<ul><li>Alternative #3 is the most efficient, but the code is slightly more complex.</li>
<li>Alternative #1 and #2 are equivalent,
with #1 optimal when the collection gets modified rarely, or it gets read frequently; because it is updated upon each modification.</li>
<li>Alternative #2 is optimal when the collection gets modified frequently, or it gets read rarely; because it is updated upon each read.</li>
</ul></span></div><div id="page-footer" class="page-footer"><div class="share-buttons__share-buttons___3c-nq"><ul class="share-buttons__share-items___35ozf"><li class="share-buttons__share-item___10u_7"><a href="mailto:?subject=BackboneJs Grouped Collection Techniques - Four Approaches - Brendan Graetz&amp;amp;body=http://blog.bguiz.com/2013/10/22/backbonejs-grouped-collection-techniques-four" class="share-buttons__share-button-email___3ktqW share-buttons__share-button___36_MO"><span class="fa fa-envelope"></span><div class="share-count"> </div></a></li><li class="share-buttons__share-item___10u_7"><div role="button" tabindex="0" class="SocialMediaShareButton SocialMediaShareButton--facebook share-buttons__share-button-facebook___uSKF_ share-buttons__share-button___36_MO"><span class="fa fa-facebook"></span><div class="SocialMediaShareCount share-count"><span class="share-count-inner">&nbsp;</span></div></div></li><li class="share-buttons__share-item___10u_7"><div role="button" tabindex="0" class="SocialMediaShareButton SocialMediaShareButton--twitter share-buttons__share-button-twitter___3vZWS share-buttons__share-button___36_MO"><span class="fa fa-twitter"></span><div class="share-count"> </div></div></li><li class="share-buttons__share-item___10u_7"><div role="button" tabindex="0" class="SocialMediaShareButton SocialMediaShareButton--googlePlus share-buttons__share-button-google-plus___1OUuW share-buttons__share-button___36_MO"><span class="fa fa-google-plus"></span><div class="SocialMediaShareCount share-count"><span class="share-count-inner">&nbsp;</span></div></div></li><li class="share-buttons__share-item___10u_7"><div role="button" tabindex="0" class="SocialMediaShareButton SocialMediaShareButton--linkedin share-buttons__share-button-linkedin___2EwnF share-buttons__share-button___36_MO"><span class="fa fa-linkedin"></span><div class="SocialMediaShareCount share-count"><span class="share-count-inner">&nbsp;</span></div></div></li></ul></div><div><span>Tagged in:</span><ul class="post-tags__tags-list___3m4XD"><li class="post-tags__tags-item___3xlEk"><a href="/tags/javascript">javascript</a></li><li class="post-tags__tags-item___3xlEk"><a href="/tags/backbonejs">backbonejs</a></li><li class="post-tags__tags-item___3xlEk"><a href="/tags/blog">blog</a></li></ul></div><div><a href="https://github.com/bguiz/blog.bguiz.com/blob/develop/src/documents/tumblrposts/2013-10-22-backbonejs-grouped-collection-techniques-four.html" target="_blank">Edit this content</a></div><div><div title="BackboneJs Grouped Collection Techniques - Four Approaches"><div id="disqus_thread"></div><noscript><span>Please enable JavaScript to view the<a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></span></noscript><a href="http://disqus.com" class="dsq-brlink">blog comments powered by<span class="logo-disqus">Disqus</span></a></div></div></div></div></div><div id="footprofile" class="foot-profile__footprofile___23hoj"><div class="foot-profile__footprofile-logo___3JA-e"><img src="/images/logo-100px.png" alt="Brendan Graetz"/></div><div class="foot-profile__footprofile-links___3U9KR"><ul class="foot-profile__footer-links___2SYBF"><li class="foot-profile__footer-item___22yBd"><a title="Brendan Graetz" href="/"><span class="fa fa-home foot-profile__footer-link-icon___11CDs"></span><span class="foot-profile__footer-link-text___1slED">Brendan Graetz</span></a></li><li class="foot-profile__footer-item___22yBd"><a title="Archives" href="/archives"><span class="fa fa-files-o foot-profile__footer-link-icon___11CDs"></span><span class="foot-profile__footer-link-text___1slED">Archives</span></a></li><li class="foot-profile__footer-item___22yBd"><a title="Presentations" href="/presentations"><span class="fa fa-television foot-profile__footer-link-icon___11CDs"></span><span class="foot-profile__footer-link-text___1slED">Presentations</span></a></li><li class="foot-profile__footer-item___22yBd"><a title="Books" href="/books"><span class="fa fa-book foot-profile__footer-link-icon___11CDs"></span><span class="foot-profile__footer-link-text___1slED">Books</span></a></li><li class="foot-profile__footer-item___22yBd"><a href="https://twitter.com/bguiz" title="@bguiz on Twitter"><span class="fa fa-twitter foot-profile__footer-link-icon___11CDs"></span><span class="foot-profile__footer-link-text___1slED">@bguiz</span></a></li><li class="foot-profile__footer-item___22yBd"><a href="https://github.com/bguiz" title="bguiz on github"><span class="fa fa-github foot-profile__footer-link-icon___11CDs"></span><span class="foot-profile__footer-link-text___1slED">Github</span></a></li><li class="foot-profile__footer-item___22yBd"><a href="http://stackoverflow.com/users/194982/bguiz" title="bguiz on stackoverflow"><span class="fa fa-stack-overflow foot-profile__footer-link-icon___11CDs"></span><span class="foot-profile__footer-link-text___1slED">Stackoverflow</span></a></li><li class="foot-profile__footer-item___22yBd"><a href="http://linkedin.com/in/brendangraetz/" title="Brendan Graetz on LinkedIn"><span class="fa fa-linkedin foot-profile__footer-link-icon___11CDs"></span><span class="foot-profile__footer-link-text___1slED">LinkedIn</span></a></li><li class="foot-profile__footer-item___22yBd"><a href="http://reddit.com/u/bguiz" title="/u/bguiz on Reddit"><span class="fa fa-reddit-alien foot-profile__footer-link-icon___11CDs"></span><span class="foot-profile__footer-link-text___1slED">Reddit</span></a></li><li class="foot-profile__footer-item___22yBd"><a href="https://plus.google.com/112370545733832378774?rel=author" title="@bguiz on Google+"><span class="fa fa-google-plus foot-profile__footer-link-icon___11CDs"></span><span class="foot-profile__footer-link-text___1slED">+bguiz.com</span></a></li></ul></div><div class="foot-profile__clear___1vNYP"></div></div><div id="footbar" class="footbar__footbar___2dhrz"><p class="footbar__footbar-text___Rc4dT">Copyright © 2008-present Brendan Graetz</p></div></div>
    </div>
    
<link rel="stylesheet" type="text/css" href="/app.css">
<link rel="stylesheet" type="text/css" href="/3rd-party/font-awesome/css/font-awesome.min.css">
<link rel="stylesheet" type="text/css" href="/3rd-party/highlight-js/css/dracula.css">
<script type="text/javascript" src="/bundle.js"></script>
  </body>
</html>